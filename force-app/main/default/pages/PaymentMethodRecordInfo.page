<apex:page sidebar="false" standardController="BWP_Payment_Method__c" extensions="RecordInfoExtension" tabStyle="BWP_Payment_Method__c" title="Payment Method for {!sobj['Customer__r.Name']}">
    <apex:form id="formId">
        <html xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <title>Breadwinner Payment Method Record</title>
            <head>
                <meta charset="utf-8" />
                <meta http-equiv="x-ua-compatible" content="ie=edge" />
                <meta name="viewport" content="width=device-width, initial-scale=1" />
                <apex:slds />
                <script src="{!URLFOR($Resource.Breadwinner_Payments,'Breadwinner_Payments/js/jquery-3.3.1.min.js')}"></script>
                 <script type="text/javascript" src="{!IF(config.Live_Mode__c, 'https://js.squareup.com/v2/paymentform', 'https://js.squareupsandbox.com/v2/paymentform')}"></script>
                <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/css/select2.min.css" rel="stylesheet" />
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.min.js"></script>
                <apex:variable value="{!OR($User.UIThemeDisplayed == 'Theme4d', $User.UIThemeDisplayed == 'Theme4t')}" var="isLightning" />
                <script type="text/javascript">
                j$ = jQuery.noConflict();
                
                j$(document).ready(function() {
                    j$('title')[0].innerText='Payment Method {!IF(paymethod.Customer__r.Customer_Name__c != null, 'for ' + JSENCODE(paymethod.Customer__r.Customer_Name__c), '')}';
                    message();
                    j$('[id$=listOfCurrencies]').select2();
                });
                
                j$(document).keyup (
                    function(event){
                        var code = event.keyCode || event.which;
                        if (code == 27) {  
                            if(j$('#messageModal').css('display') != 'none'){
                                rerenderPaymentSectionFromESC();
                            }
                            if(j$('#tsModal').css('display') != 'none'){
                                rerenderPaymentValuesFromESC();
                                console.log('came to ts modal');
                            }   
                            if(j$('#verifyModal').css('display') != 'none'){
                                renderVerifyValues();
                                // console.log('came to ts modal');
                            } 
                            j$('.slds-modal.slds-fade-in-open').removeClass('slds-fade-in-open');
                            j$('.slds-backdrop.slds-backdrop--open').removeClass('slds-backdrop--open');
                            j$("html").css({"overflow" : ""});
                        }
                    });
                function renderVerifyValues(){
                    if(j$("[id$=firstDeposit]").val() != null){
                        j$("[id$=firstDeposit]").val(0);
                    }
                    if(j$("[id$=secondDeposit]").val() != null){
                        j$("[id$=secondDeposit]").val(0);
                    }
                }
                function rerenderVerifyACHErrors(){
                    if(j$("[id$=errormessage]").text() != null){
                        j$("[id$=errormessage]").text('');
                    }
                }
                function showHideSectionConent(sectionId, sectionContentId) {
                    var sectiondiv = document.getElementById(sectionId);
                    j$("#" + sectionContentId).show();
                    if (j$(sectiondiv).hasClass("slds-is-open")) {
                        j$(sectiondiv).removeClass("slds-is-open");
                    } else {
                        j$(sectiondiv).addClass("slds-is-open");
                    }
                }
                
                function showModal(modalId,backdropId,contentId,content){
                    j$('#'+ contentId).html(content);
                    j$('#'+ modalId).addClass('slds-fade-in-open');
                    j$('#'+ backdropId).addClass('slds-backdrop--open');
                    j$("html").css({"overflow" : "hidden"});
                }
                
                function closeModal(modalId,backdropId){
                    j$('#'+ modalId).removeClass('slds-fade-in-open');
                    j$('#'+ backdropId).removeClass('slds-backdrop--open');
                    j$("html").css({"overflow" : ""});
                    if(modalId == 'tsModal'){
                        rerenderPaymentValuesFromESC();
                    }
                    if(modalId == 'verifyModal'){
                        renderVerifyValues();
                    }
                }
                
                function showmsgPannel() {
                    closeModal('tsModal', 'tsBackdrop');
                    showModal('messageModal', 'messageBackdrop', 'deleteMessage', '');
                }
                
                function message() {
                    j$(".infoM6, .infoM4, .infoM3, .infoM2, .infoS1").addClass("slds-notify slds-notify_alert slds-theme_inverse-text  slds-text-align_left slds-text-heading_small slds-m-bottom_small").css( {"font-weight":"500","line-height":"1.4","word-spacing":"1px","justify-content":"left", "background":"rgba(84,105,141,.95)"} );
                    j$(".errorM6, .errorM4, .errorM3, .errorM2, .errorS1").addClass("slds-notify slds-notify_alert slds-theme_error  slds-text-align_left slds-text-heading_small slds-m-bottom_xx-small slds-m-top_xx-small").css({"font-weight":"500","line-height":"1.4","word-spacing":"1px","justify-content":"left"});
                    j$(".warningM6, .warningM4, .warningM3, .warningM2, .warningS1").addClass("slds-notify slds-notify_alert slds-theme_warning  slds-text-align_left slds-text-heading_small slds-m-bottom_small").css( {"font-weight":"500","line-height":"1.4","word-spacing":"1px","justify-content":"left"}) ;
                    j$(".confirmM6, .confirmM4, .confirmM3, .confirmM2, .confirmS1").addClass("slds-notify slds-notify_alert slds-theme_success slds-text-align_left slds-text-heading_small slds-m-bottom_small").css( {"font-weight":"500","line-height":"1.4","word-spacing":"1px","justify-content":"left"} ) ;
                    
                    j$("div .messageText h4").css( "color", "white" );
                    j$("div[class*='warning'] div.messageText h4").css( "color", "black" );
                    j$("table.messageTable td").css({"color" : "white"});
                    j$("div[class*='warning'] table.messageTable td").css( "color", "black" );
                }
                
                function validateFloatKeyPress(el, evt) {
                    var charCode = (evt.which) ? evt.which : event.keyCode;
                    var number = el.value.split('.');
                    if (charCode != 46 && charCode > 31 && (charCode < 48 || charCode > 57)) {
                        return false;
                    }
                    var currency = j$("[id$=listOfCurrencies]").val();
                    console.log('currency----'+currency);
                    if(currency.match("bif|clp|djf|gnf|jpy|kmf|krw|mga|pyg|rwf|ugx|vnd|vuv|xaf|xof|xpf")){
                        if(charCode == 46){
                            return false;
                        }
                    }
                    else{
                        if(number.length>1 && charCode == 46){
                            return false;
                        }
                    }
                    //get the carat position
                    var caratPos = getSelectionStart(el);
                    console.log('caratPos----'+caratPos);
                    var dotPos = el.value.indexOf(".");
                    if( caratPos > dotPos && dotPos>-1 && (number[1].length > 1)){
                        return false;
                    }
                    return true;
                }
                
                function getSelectionStart(o) {
                    return o.selectionStart;
                }
                
                function verifyAmount(){
                    var type = j$("[id$=cardType]").val();
                    var brand = j$("[id$=cardBrand]").val();
                    var currency = j$("[id$=listOfCurrencies]").val();
                    console.log('currency------'+currency);
                    if(currency.match("bif|clp|djf|gnf|jpy|kmf|krw|mga|pyg|rwf|ugx|vnd|vuv|xaf|xof|xpf")){
                        var chargeAmount = j$("[id$=chargingAmount]").val();
                        var removeDecimals = chargeAmount.replace('.','');
                        console.log('removeDecimals---'+removeDecimals);
                        j$("[id$=chargingAmount]").val(removeDecimals);
                    }
                    var paymentAmount = j$("[id$=chargingAmount]").val();
                    console.log('paymentAmount'+paymentAmount);
                    var numbers = /^[0-9.,]+$/;
                    if(paymentAmount!='' && (!paymentAmount.match(numbers))){
                        j$("[id$=amountValidations]").val('Please enter a valid payment amount.');
                    }
                    else{
                        j$("[id$=amountValidations]").val('');
                        var chargeAmount = parseFloat(paymentAmount);
                        var cardOrBankAccount = (type == 'Card' ? brand+' Card' : 'Bank Account');
                        console.log('cardOrBankAccount---'+cardOrBankAccount);
                        if(currency.match("bif|clp|djf|gnf|jpy|kmf|krw|mga|pyg|rwf|ugx|vnd|vuv|xaf|xof|xpf")){
                            var amount = chargeAmount > 0 ? (' for '+chargeAmount+' '+currency.toUpperCase()) : '';
                        }
                        else{
                            var amount = chargeAmount > 0 ? (' for '+chargeAmount.toFixed(2)+' '+currency.toUpperCase()) : '';
                        }
                        console.log(amount);
                        j$("[id$=PaymentCreateBtn]").val('Charge '+cardOrBankAccount+''+amount);
                        j$("[id$=PaymentCreateBtnSquare]").val('Charge '+cardOrBankAccount+''+amount);
                    }
                }
                
                function clearAmount(){
                    if(j$("[id$=chargingAmount]").val() == 0){
                        j$("[id$=chargingAmount]").val(null);
                    }
                }
                function clearTaxAmount(){
                    if(j$("[id$=chargingTaxAmount]").val() == 0){
                        j$("[id$=chargingTaxAmount]").val(null);
                    }
                }
                function clearfirstDeposit(){
                    if(j$("[id$=firstDeposit]").val() == 0){
                        j$("[id$=firstDeposit]").val(null);
                    }
                }
                function clearsecondDeposit(){
                    if(j$("[id$=secondDeposit]").val() == 0){
                        j$("[id$=secondDeposit]").val(null);
                    }
                }
                function rerenderPaymentValues(){
                    if(j$("[id$=chargingAmount]").val() != null){
                        j$("[id$=chargingAmount]").val(0);
                    }
                    if(j$("[id$=amountValidations]").val() != null){
                        j$("[id$=amountValidations]").val('');
                    }
                    if(j$("[id$=invalidValues]").val() != null){
                        j$("[id$=invalidValues]").val('');
                    }
                    if(j$("[id$=chargingTaxAmount]").val() != null){
                        j$("[id$=chargingTaxAmount]").val(0);
                    }
                    if(j$("[id$=chargeIsTaxExempt]").val() != null){
                        j$("[id$=chargeIsTaxExempt]").val(false);
                    }
                }
                
                function closeVerifyModal() {
                    console.log('in closeVerifyModal');
                        closeModal('verifyModal', 'verifyBackdrop');
                }
                
                function showhideImage(id){
                    var host = "{!LEFT($Api.Enterprise_Server_URL_330, FIND('/services',$Api.Enterprise_Server_URL_330))}";
                    var right = '{!URLFOR($Resource.Breadwinner_Payments,'Breadwinner_Payments/images/Chevronright_Black.png')}';
                    var down = '{!URLFOR($Resource.Breadwinner_Payments,'Breadwinner_Payments/images/Chevrondown_Black.png')}';
                    var rightImage = host+right.slice(1);
                    var downImage = host+down.slice(1);
                    var imgElement = document.getElementById(id);
                    imgElement.src = (imgElement.src == rightImage)? downImage : rightImage;
                }
                </script>
                <style>
                    .slds-scope .slds-tile+.slds-tile {
                    margin-top: 0rem !important;
                    }
                    
                    .slds-scope .slds-item_label {
                    color: #54698d;
                    padding-bottom: 5px;
                    font-weight: normal;
                    }
                    
                    .slds-scope .slds-form-element {
                    min-height: 45px;
                    }
                    .message {
                    background-color: inherit;
                    border-style: none;
                    padding: initial;
                    margin: 0px !important;
                    }
                    
                    table.messageTable td {
                    border-top: 1px !important;
                    }
                    
                    .table-space td{        
                    padding: 10px !important;       
                    }
                    
                    .msgIcon {
                    display: none;
                    }
                    
                    .message .messageText {
                    margin: 0px;
                    }
                    
                    .message .messageText h4 {
                    font-weight: inherit;
                    display: initial;
                    }
                    
                    .slds-scope .slds-table .messageTable td {
                    padding: 1px;
                    }
                    
                    @media only screen and (max-width: 767px) {
                    .slds-scope .slds-list_vertical .slds-item_detail {
                    width: 100%;
                    border-bottom: 1px solid rgb(221, 219, 218);
                    margin-bottom: 4px;
                    min-height: 1.5rem;
                    }
                    .cardBrand {
                    display: inline-flex !important;
                    }
                    .logo {
                    padding-left: 10px;
                    padding-bottom: 5px;
                    }
                    }
                    
                    @media only screen and (max-width: 768px) {
                    .slds-scope .slds-table_col-bordered td+td {
                    border-left: none;
                    }
                    .slds-scope .slds-border_right {
                    border-right: none;
                    }
                    .slds-scope .slds-border_left {
                    border-left: none;
                    }
                    /*.payments tr>td:nth-child(3):before {
                    width: 100%;
                    }
                    .payments tr>td:nth-child(3) {
                    text-align: left;
                    }*/
                    }
                    @media only screen and (max-width: 425px) {
                    .payments tr>td:nth-child(n):before {
                    width: 100%;
                    }
                    .payments tr>td:nth-child(n) {
                    text-align: left;
                    }
                    }
                    .slds-scope .slds-section__title-action:hover,
                    .slds-scope .slds-section__title-action:focus,
                    .slds-scope .slds-section__title-action:active {
                    background: rgb(243, 242, 242);
                    box-shadow: none;
                    }
                    .slds-scope .slds-item_label {
                    font-size: 0.75rem;
                    font-weight: bold;
                    color: #54698d;
                    }
                    .select2-results__option {
                    margin-left:0;
                    line-height: 18px !important;
                    }
                    .select2-container .select2-selection--single .select2-selection__rendered{
                    padding-right:0px !important;
                    text-overflow: inherit;
                    }
                    .select2-container--default .select2-selection--single .select2-selection__rendered {
                    line-height: 23px !important;
                    margin: -11px;
                    margin-right: 1.1rem;
                    }
                    .select2-container .select2-selection--single{
                    height: 23px !important;
                    padding: 15px;
                    }
                    .slds-select .select2{
                    font-color:red !important;
                    padding-left: 0px !important;
                    }
                    
                    .select2-container--default .select2-selection--single {
                    border: 1px solid #d8dde6;
                    }
                    .select2-container--default .select2-selection--single .select2-selection__arrow b {
                    border-color: black transparent transparent;
                    transform: rotate(180deg);
                    margin-left: -3px;
                    border-width: 5px 3px 1px 3px;
                    top: 29%;
                    }
                    .select2-container--default.select2-container--open .select2-selection--single .select2-selection__arrow b{
                    border-color: transparent transparent black transparent;
                    transform: rotate(0deg);
                    margin-left: -3px;
                    border-width: 5px 3px 5px 3px;
                    top: 15%;
                    }
                    .select2-dropdown{
                    border: 1px solid #d8dde6;
                    }
                    .select2-results__options {
                    list-style: inherit;
                    }
                    li.select2-results__option{
                    margin-left: 0px;
                    }
                    .select2-container--default .select2-search--dropdown .select2-search__field {
                    border: 1px solid #d8dde6;
                    border-radius: 4px;
                    }
                    .select2-container.select2-container--default.select2-container--open {
                    z-index: 9002;
                    }
                    .slds-scope .slds-select_container:after {
                    z-index: 9003;
                    }
                    .slds-scope .slds-spinner_container{
                    position: fixed !important;
                    }
                    .select2.select2-container.select2-container--default{
                    width: 100% !important;
                    }
                    .slds-scope .slds-card+.slds-card {
                    margin: 0rem !important;
                    }
                    @media only screen and (max-width:620px){                
                    .headersecondcol { justify-content: left !important; padding-top: 0.75rem;}
                    }
                </style>
            </head>
            <body>
                <apex:actionStatus id="assign-action-status" layout="block">
                    <apex:facet name="start">
                        <div class="slds-spinner_container">
                            <div class="slds-spinner_brand slds-spinner slds-spinner_medium" aria-hidden="false" role="alert">
                                <div class="slds-spinner__dot-a"></div>
                                <div class="slds-spinner__dot-b"></div>
                            </div>
                        </div>
                    </apex:facet>
                </apex:actionStatus>
                <div class="slds-scope" style="{!IF(AND(isLightning,showBWLayout), 'background: rgba(176, 196, 223, 1);','')};">
                    <apex:outputPanel layout="block" rendered="{!NOT(showBWLayout)}">
                        <div class="slds-box slds-align_absolute-center" style="height: 200px;">
                            <table width="100%" border="0" cellpadding="0" cellspacing="0">
                                <tr>
                                    <td class="image" style="width: 200px;">
                                        <apex:image url="{!URLFOR($Resource.Breadwinner_Payments,'Breadwinner_Payments/images/BreadwinnerLogo.png')}" />
                                    </td>
                                    <td class="content">
                                        <div style="text-align: center;">
                                            <apex:outputLink id="newSPMCUI" rendered="{!NOT(isLightning)}" value="{!$Page.PaymentMethodRecordInfo}?id={!recordId}&showBWLayout=true" target="_parent" style="font-size: 2.1em;">View {!paymethod.Processor_Type__c} Payment Method in Dedicated Layout</apex:outputLink>
                                            <apex:outputLink id="newSPMUILtng" rendered="{!isLightning}" value="{!$Page.PaymentMethodRecordInfo}?id={!recordId}&showBWLayout=true" style="font-size: 2.1em;">View {!paymethod.Processor_Type__c} Payment Method in Dedicated Layout</apex:outputLink>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </apex:outputPanel>
                    <apex:outputPanel rendered="{!AND(showBWLayout,NOT(ISNULL(paymethod.id)))}" layout="block" styleClass="{!IF(isLightning,'slds-p-around_small slds-brand-band slds-brand-band_cover slds-brand-band_medium','')}">
                        <!-- Page Header Start -->
                        <div class="slds-page-header slds-m-bottom_x-small" role="banner">
                            <div class="slds-grid slds-wrap">
                                <div class="slds-col slds-has-flexi-truncate slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_6-of-12">
                                    <div class="slds-media slds-media_center">
                                        <div class="slds-media__figure">
                                            <span class="slds-icon_container slds-icon-custom-custom16">
                                                <svg class="slds-icon slds-page-header__icon" aria-hidden="true">
                                                    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS, 'assets/icons/custom-sprite/svg/symbols.svg#custom16')}" />
                                                </svg>
                                                <span class="slds-assistive-text">{!paymethod.Processor_Type__c} Payment Method</span>
                                            </span>
                                        </div>
                                        <div class="slds-media__body">
                                            <p>{!paymethod.Processor_Type__c} Payment Method</p>
                                            <p class="slds-text-heading_small slds-line-height_reset slds-page-header__title">
                                                <apex:outputText value="{!IF(paymethod.Type__c == 'BankAccount', 'Bank Account', 'Card')}"/>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                <apex:outputPanel id="buttonsSection" layout="block" styleClass="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_6-of-12 headersecondcol">
                                    <div class="slds-text-align_right">
                                        <apex:commandButton id="verifyBtn" rendered="{!IF(AND(OR(paymethod.Processor_Type__c == 'Stripe', paymethod.Processor_Type__c == 'Braintree'),paymethod.Type__c=='BankAccount',OR(paymethod.Card_Status__c=='New',paymethod.Card_Status__c=='Pending')), true, false)}" value="Verify" onclick="showModal('verifyModal','verifyBackdrop');rerenderVerifyACHErrors();" reRender="verifyButtonsSection"  styleClass="slds-button slds-button_brand slds-m-top_x-small"  disabled="{!IF(OR(!isCustomerRelatedOrgConnected, AND(paymethod.Type__c=='BankAccount', paymethod.Card_Status__c == 'Verified')), 'TRUE','FALSE')}"/>
                                        <apex:commandButton id="tsDeletePaymentBtn" rendered="{!canCreatePayment}" value="Charge this Customer" onclick="showModal('tsModal','tsBackdrop','deleteMessage','payment');rerenderPaymentValues();" styleClass="slds-button slds-button_brand slds-m-top_x-small" reRender="paymentButtonsSection" disabled="{!IF(OR(!isCustomerRelatedOrgConnected, AND(paymethod.Type__c=='BankAccount',paymethod.Card_Status__c!='Verified')), 'TRUE','FALSE')}"/>                                   
                                    </div>
                                </apex:outputPanel>
                            </div>
                        </div>
                        
                        <!-- Page header end -->
                        <apex:pageMessages /> 
                        <apex:outputPanel id="verifyBankAccount">
                            <apex:outputPanel rendered="{!IF(AND(OR(paymethod.Processor_Type__c == 'Stripe',paymethod.Processor_Type__c == 'Braintree'),paymethod.Type__c=='BankAccount'), true, false)}">
                                <div>
                                    <div id="verifyModal" class="slds-modal slds-modal_x-small" aria-hidden="false" role="dialog">
                                        <div class="slds-modal__container">
                                            <div class="slds-modal__header">
                                                <button class="slds-button slds-button_icon-inverse slds-modal__close" type="button" onclick="closeModal('verifyModal','verifyBackdrop');">
                                                    <svg aria-hidden="true" class="slds-button__icon slds-button__icon_large" >
                                                        <use xlink:href="{!URLFOR($Asset.SLDS, 'assets/icons/action-sprite/svg/symbols.svg#close')}" ></use>
                                                    </svg>
                                                    <span class="slds-assistive-text">Close</span>
                                                </button>
                                                <h2 class="slds-text-heading_medium">Verify Bank Account</h2>
                                            </div>
                                            <div class="slds-modal__content slds-p-horizontal_medium slds-p-bottom_medium slds-p-top_small">
                                                <div align="center">
                                                    <apex:outputPanel rendered="{!IF(paymethod.Processor_Type__c == 'Stripe', true, false)}" layout="block" style="text-align:center;padding-top: 8px;">
                                                        Stripe sent two small deposits to this bank account. To verify this account, please confirm the amounts of these deposits.
                                                    </apex:outputPanel>
                                                    <apex:outputPanel layout="block" styleClass="slds-m-bottom_xxx-small" id="verifyError">
                                                        <apex:outputText rendered="{!if(OR(verifyACHErrors != NULL, verifyACHErrors != ''), true, false)}" style="color:red">
                                                            <p class="slds-text-body_regular" id="errormessage" style="background-color: white; color: red; padding-right: 5px;">{!verifyACHErrors}</p>
                                                        </apex:outputText>
                                                    </apex:outputPanel>
                                                </div>
                                                <apex:outputPanel id="readOnlyMessage1">
                                                    <apex:outputPanel layout="block" styleClass="slds-m-bottom_small" rendered="{!(isBreadwinnerReadOnlyMode)}">
                                                        <apex:pageMessage summary="You are using Breadwinner in {!paymethod.Processor_Type__c} Read Only Mode. While Breadwinner reads data from {!paymethod.Processor_Type__c}, no changes will be made to {!paymethod.Processor_Type__c}. {!paymethod.Processor_Type__c} is in Read-Only mode and will not be altered in any way." severity="INFO" strength="3"/>
                                                    </apex:outputPanel>
                                                </apex:outputPanel>
                                                <div class="slds-form-element">
                                                    <apex:outputPanel id="verifyDetails">
                                                        <label class="slds-form-element__label" >First Deposit</label>
                                                        <div class="slds-form-element__control">
                                                            <apex:inputText value="{!firstDeposit}" styleClass="slds-input" id="firstDeposit" onkeypress="return validateFloatKeyPress(this,window.event)" onKeyup="verifyAmount();" onfocus="clearfirstDeposit();" />
                                                        </div>
                                                        <label class="slds-form-element__label" >Second Deposit</label>
                                                        <div class="slds-form-element__control">
                                                            <apex:inputText value="{!secondDeposit}" styleClass="slds-input" id="secondDeposit" onkeypress="return validateFloatKeyPress(this,window.event)" onKeyup="verifyAmount();" onfocus="clearsecondDeposit();" />
                                                        </div>
                                                        <apex:outputPanel layout="block" styleClass="slds-text-align_center" id="verifyButtonsSection">
                                                            <apex:commandbutton id="verifySave" status="assign-action-status" styleClass="btns slds-button slds-button_brand slds-m-top_medium " value="Verify" action="{!verifyBankAccount}" oncomplete="{!IF(isVerifySuccess, 'closeVerifyModal();', '')}"   reRender="verifyError,statusValue,buttonsSection" disabled="{!isBreadwinnerReadOnlyMode}"  />
                                                            <apex:commandbutton id="verifyCancel" styleClass="btns slds-button slds-button_neutral slds-m-left_xx-small slds-m-top_medium" value="Cancel" reRender="nothing" onclick="closeModal('verifyModal','verifyBackdrop');" style="width:70px;"  />
                                                        </apex:outputPanel>
                                                    </apex:outputPanel>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="slds-backdrop" id="verifyBackdrop"></div>
                                </div>
                            </apex:outputPanel>
                         
                        </apex:outputPanel>
                        <apex:outputPanel id="chargingForm">
                            <!-- Charging the card -->
                            <apex:outputPanel rendered="{!!isChargeSuccess}" id="testid">
                                <div>
                                    <div id="tsModal" class="slds-modal slds-modal_x-small" aria-hidden="false" role="dialog">
                                        <div class="slds-modal__container">
                                            <div class="slds-modal__header">
                                                <button class="slds-button slds-button_icon-inverse slds-modal__close" type="button" onclick="closeModal('tsModal','tsBackdrop');">
                                                    <svg aria-hidden="true" class="slds-button__icon slds-button__icon_large" >
                                                        <use xlink:href="{!URLFOR($Asset.SLDS, 'assets/icons/action-sprite/svg/symbols.svg#close')}" ></use>
                                                    </svg>
                                                    <span class="slds-assistive-text">Close</span>
                                                </button>
                                                <h2 class="slds-text-heading_medium">Charge {!paymethod.Processor_Type__c} Customer</h2>
                                            </div>
                                            <apex:outputPanel id="chargeSection" styleClass="slds-modal__content slds-p-horizontal_medium slds-p-bottom_medium slds-p-top_small">
                                                <div align="center">
                                                    <apex:outputPanel id="invalidValues">
                                                        <apex:outputText rendered="{!!isChargeSuccess}" style="color:red">
                                                            <p class="slds-text-heading_small" style="background-color: white; color: red; padding-right: 5px;">{!chargeMessage}</p>
                                                        </apex:outputText>
                                                    </apex:outputPanel>
                                                </div>
                                                <apex:outputPanel id="readOnlyMessage">
                                                    <apex:outputPanel layout="block" styleClass="slds-m-bottom_small" rendered="{!(isBreadwinnerReadOnlyMode)}">
                                                        <apex:pageMessage summary="You are using Breadwinner in {!paymethod.Processor_Type__c} Read Only Mode. While Breadwinner reads data from {!paymethod.Processor_Type__c}, no changes will be made to {!paymethod.Processor_Type__c}. {!paymethod.Processor_Type__c} is in Read-Only mode and will not be altered in any way." severity="INFO" strength="3"/>
                                                    </apex:outputPanel>
                                                </apex:outputPanel>
                                                <div class="slds-form-element">
                                                    <apex:outputPanel id="paymentInfo">
                                                        <label class="slds-form-element__label" for="chooseCurrency">Currency</label>
                                                        <div class="slds-form-element__control">
                                                            <div class="slds-select_container">
                                                                <apex:selectList value="{!selectedCurrency}" size="1" styleClass="slds-select" id="listOfCurrencies" onchange="verifyAmount();">
                                                                    <apex:selectOptions value="{!Currencies}" />
                                                                </apex:selectList>
                                                            </div>
                                                        </div>
                                                        <label class="slds-form-element__label" for="chargingAmount">Amount</label>
                                                        <div class="slds-form-element__control">
                                                            <apex:inputText value="{!chargeAmount}" styleClass="slds-input" id="chargingAmount" onkeypress="return validateFloatKeyPress(this,window.event)" onKeyup="verifyAmount();" onfocus="clearAmount();" />
                                                        </div>
                                                        <apex:outputPanel rendered="{!paymethod.Processor_Type__c == 'Braintree'}" styleClass="slds-form-element slds-m-bottom_xx-small" layout="block" id="chargeTaxAmount">
                                                            <label class="slds-form-element__label" for="chargingTaxAmount">Tax Amount</label>
                                                            <div class="slds-form-element__control">
                                                                <apex:inputText value="{!chargeTaxAmount}" styleClass="slds-input" id="chargingTaxAmount" onkeypress="return validateFloatKeyPress(this,window.event)" onKeyup="verifyAmount();" onfocus="clearTaxAmount();"/>
                                                            </div>
                                                            <div class="slds-text-body_small slds-m-top_small">
                                                                Tax Amount is only used for Level 2 processing. The tax amount will not be added to the total transaction amount. If you would like to include tax you should include it in the transaction amount before submitting the transactions.
                                                            </div>
                                                        </apex:outputPanel>
                                                        <apex:outputPanel styleClass="slds-m-bottom_xx-small" rendered="{!paymethod.Processor_Type__c == 'Braintree'}" style="margin-top: 0.50rem;" layout="block" id="taxExempt">
                                                            <div class="slds-form-element__control">
                                                                <span class="slds-checkbox">
                                                                    <label class="slds-checkbox__label" >
                                                                        <apex:inputCheckbox value="{!chargeIsTaxExempt}" id="chargeIsTaxExempt"/>
                                                                        <span class="slds-checkbox_faux"></span>
                                                                        <span class="slds-form-element__label slds-m-left_xx-small">Tax Exempt</span>                                                                    
                                                                    </label>
                                                                </span>
                                                            </div>
                                                        </apex:outputPanel>
                                                        <apex:outputPanel id="cardDetails">
                                                            <apex:inputHidden id="cardType" value="{!payMethod.Type__c}" />
                                                            <apex:inputHidden id="cardBrand" value="{!payMethod.Card_Brand__c}" />
                                                        </apex:outputPanel>
                                                        <apex:outputPanel layout="block" styleClass="slds-m-top_xx-small" id="amountValidationSection"><apex:outputText id="amountValidations" style="color: red;"/></apex:outputPanel>
                                                        <apex:actionFunction id="rerenderButtonsSection" name="rerenderButtonsSection" rerender="paymentButtonsSection" />
                                                        <apex:outputPanel rendered="{!paymethod.Processor_Type__c == 'Stripe'}">
                                                            <label class="slds-form-element__label" for="chargingDescription">Description</label>
                                                            <div class="slds-form-element__control">
                                                                <apex:inputText value="{!chargingDescription}" id="chargingDescription" styleClass="slds-input" />
                                                            </div>
                                                        </apex:outputPanel>
                                                    </apex:outputPanel>
                                                </div>
                                                <apex:actionStatus id="action-status" layout="block">
                                                    <apex:facet name="start">
                                                        <div class="slds-spinner_container">
                                                            <div class="slds-spinner_brand slds-spinner slds-spinner_medium" aria-hidden="false" role="alert">
                                                                <div class="slds-spinner__dot-a"></div>
                                                                <div class="slds-spinner__dot-b"></div>
                                                            </div>
                                                        </div>
                                                    </apex:facet>
                                                </apex:actionStatus>
                                                <apex:outputPanel layout="block" styleClass="slds-text-align_center" id="paymentButtonsSection">
                                                    <apex:inputHidden id="idempotencyKey" value="{!idempotencyKey}"/>
                                                    <apex:actionFunction id="processKey" name="processKey" reRender="idempotencyKey" />
                                                    <apex:commandbutton id="PaymentCreateBtnSquare" status="assign-action-status" styleClass="btns slds-button slds-button_brand slds-m-top_medium " value="Charge {!payMethod.Card_Brand__c} Card {!If(AND(chargeAmount != NULL, (chargeAmount) > 0), ('for' + ' '+TEXT(chargeAmount)+' '+UPPER(selectedCurrency)), '')}" action="{!chargeCustomer}" reRender=" messageModalPanel, invalidValues" disabled="{!isBreadwinnerReadOnlyMode}"  onclick="setIdempotencyKey();" oncomplete="{!if(isChargeSuccess, 'showmsgPannel();','')}"  rendered="{!AND(paymethod.Processor_Type__c == 'Square')}"/>
                                                    <apex:commandbutton id="PaymentCreateBtn" status="assign-action-status" styleClass="btns slds-button slds-button_brand slds-m-top_medium " value="Charge {!If(payMethod.Type__c == 'Card', payMethod.Card_Brand__c+' Card', 'Bank Account')} {!If(AND(chargeAmount != NULL, (chargeAmount) > 0), ('for' + ' '+TEXT(chargeAmount)+' '+UPPER(selectedCurrency)), '')}" action="{!chargeCustomer}" reRender=" messageModalPanel, invalidValues" disabled="{!isBreadwinnerReadOnlyMode}" oncomplete="{!if(isChargeSuccess, 'showmsgPannel();','')}" rendered="{!AND(paymethod.Processor_Type__c != 'Square')}" />
                                                    <apex:commandbutton id="tsOKCancelBtn" styleClass="btns slds-button slds-button_neutral slds-m-left_xx-small slds-m-top_medium" value="Cancel" onclick="closeModal('tsModal','tsBackdrop');" reRender="nothing, invalidValues, paymentInfo" style="width:70px;" action="{!renderpage}" />
                                                </apex:outputPanel>
                                                <apex:actionFunction name="rerenderPaymentValuesFromESC" action="{!renderpage}" reRender="chargeSection, invalidValues, paymentInfo, PaymentCreateBtn" />

                                            </apex:outputPanel>
                                        </div>
                                    </div>
                                    <div class="slds-backdrop" id="tsBackdrop"></div>
                                </div>
                                <script>
                                function uuidv4() {
                                    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                                        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                                        return v.toString(16);
                                    });
                                }
                                function setIdempotencyKey(){
                                    const idempotency_key = uuidv4();
                                    j$("[id$=idempotencyKey]").val(idempotency_key);
                                    var idempotencyKey = j$("[id$=idempotencyKey]").val();
                                    // console.log('--idempotencyKey--'+idempotencyKey);
                                    if(idempotencyKey!=null) processKey();
                                }
                                </script>
                                <!-- Charging the card end -->
                            </apex:outputPanel>
                        </apex:outputPanel>
                        <apex:actionFunction name="chargeCustomer" reRender="messageModalPanel" />                                            
                        <apex:outputPanel id="messageModalPanel">
                            <div>
                                <div id="messageModal" class="slds-modal slds-modal_x-small" aria-hidden="false" role="dialog">
                                    <div class="slds-modal__container">
                                        <div class="slds-modal__header {!IF(!isChargeSuccess, 'slds-theme_error', 'slds-theme_success')}">
                                            <h2 class="slds-text-heading_medium" style="color: white">
                                                {!IF(isChargeSuccess, 'The Payment was Successful','The Payment is failed')}
                                            </h2>
                                        </div>
                                        <div class="slds-modal__content slds-p-around_medium">
                                            <div style="text-align: left;">
                                                <apex:outputText rendered="{!isChargeSuccess}">
                                                    The Payment was successfully processed by {!paymethod.Processor_Type__c}<apex:outputText rendered="{!(paymethod.customer__r.Customer_Name__c != NULL)}">, and "{!paymethod.customer__r.Customer_Name__c}" was charged 
                                                    <apex:outputText value="{0, number, ###,###,##0}" rendered="{!if((selectedCurrency='bif'||selectedCurrency='clp'||selectedCurrency='djf'||selectedCurrency='gnf'||selectedCurrency='jpy'||selectedCurrency='kmf'||selectedCurrency='krw'||selectedCurrency='mga'||selectedCurrency='pyg'||selectedCurrency='rwf'||selectedCurrency='ugx'||selectedCurrency='vnd'||selectedCurrency='vuv'||selectedCurrency='xaf'||selectedCurrency='xof'||selectedCurrency='xpf'), true,false)}">
                                                        <apex:param value="{!createdPaymentInfo.Amount__c}" />
                                                    </apex:outputText>
                                                    <apex:outputText value="{0, number, ###,###,##0.00}" rendered="{!if((selectedCurrency='bif'||selectedCurrency='clp'||selectedCurrency='djf'||selectedCurrency='gnf'||selectedCurrency='jpy'||selectedCurrency='kmf'||selectedCurrency='krw'||selectedCurrency='mga'||selectedCurrency='pyg'||selectedCurrency='rwf'||selectedCurrency='ugx'||selectedCurrency='vnd'||selectedCurrency='vuv'||selectedCurrency='xaf'||selectedCurrency='xof'||selectedCurrency='xpf'), false,true)}">
                                                        <apex:param value="{!createdPaymentInfo.Amount__c}" />
                                                    </apex:outputText>
                                                    </apex:outputText>. You can see this Payment in Salesforce at <a href="/{!createdPaymentInfo.id}" target="__blank">{!createdPaymentInfo.Name}</a>.
                                                </apex:outputText>
                                                <apex:outputText rendered="{!!isChargeSuccess}">
                                                    The transaction is failed.
                                                    <p>{!chargeMessage}</p>
                                                </apex:outputText>
                                            </div>
                                            <div align="center" class="slds-m-top_medium">
                                                <apex:commandbutton id="tsOKCancelBtn2" styleClass="btns slds-button slds-button_neutral" value="Okay" onclick="closeModal('tsModal','tsBackdrop');closeModal('messageModal','messageBackdrop');" style="width:70px;" action="{!renderpage}" rendered="{!isChargeSuccess}" oncomplete="renderPaymentsSection()" reRender="paymentInfo"/>
                                                <apex:commandbutton id="tsOKCancelBtn3" styleClass="btns slds-button slds-button_neutral" value="Okay" onclick="closeModal('messageModal', 'messageBackdrop');showModal('tsModal','tsBackdrop','deleteMessage','payment');" reRender="testingid" style="width:70px;" action="{!renderpage}" rendered="{!!isChargeSuccess}"/>
                                                <apex:actionFunction name="renderPaymentsSection" reRender="paymentsSection, paymentInfo" ></apex:actionFunction>
                                                <apex:actionFunction name="rerenderPaymentSectionFromESC" action="{!renderPage}" oncomplete="renderPaymentsSection();" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="slds-backdrop" id="messageBackdrop"></div>
                            </div>
                        </apex:outputPanel>
                        <div class="slds-card slds-p-bottom_none slds-m-bottom_small slds-grid slds-grid_vertical slds-m-top_xx-small" id="detailsSection" style="background: white;">
                            <div class="slds-card__header slds-p-bottom_small slds-border_bottom slds-m-bottom_none" >
                                <div class="slds-grid slds-gutters slds-wrap">
                                    
                                    <apex:outputPanel styleClass="slds-col slds-tile slds-large-size_1-of-5 slds-size_1-of-1 slds-medium-size_1-of-5" rendered="{!AND(paymethod.Type__c!='Card',paymethod.Type__c!='BankAccount')}">
                                       <c:PaymentAndPMDetails label="Type" fieldValue="{!paymethod.Type__c}" />
                                    </apex:outputPanel>
                                    
                                    <apex:outputPanel styleClass="slds-col slds-tile slds-large-size_1-of-5 slds-size_1-of-1 slds-medium-size_1-of-5" rendered="{!paymethod.Type__c=='BankAccount'}">
                                        <c:PaymentAndPMDetails label="Account Holder Name" fieldValue="{!paymethod.Bank_Account_Holder_Name__c}" />
                                    </apex:outputPanel>
                                    
                                    <apex:outputPanel styleClass="slds-col slds-tile slds-large-size_1-of-5 slds-size_1-of-1 slds-medium-size_1-of-5" rendered="{!paymethod.Type__c!='Card'}">
                                        <c:PaymentAndPMDetails label="Bank Name" fieldValue="{!paymethod.Bank_Name__c}" />
                                    </apex:outputPanel>
                                    
                                    <apex:outputPanel styleClass="slds-col slds-tile slds-size_1-of-1 {!IF(AND(paymethod.Type__c=='Card',NOT(ISNULL(paymethod.Card_Status__c))),'slds-large-size_1-of-6 slds-medium-size_1-of-6','slds-large-size_1-of-5 slds-medium-size_1-of-5')}" rendered="{!paymethod.Type__c=='Card'}">
                                       <c:PaymentAndPMDetails label="Name On Card" fieldValue="{!paymethod.Name_On_Card__c}" />
                                    </apex:outputPanel>
                                    
                                    <apex:outputPanel styleClass="slds-col slds-tile {!IF(AND(paymethod.Type__c=='Card',NOT(ISNULL(paymethod.Card_Status__c))),'slds-large-size_1-of-6 slds-medium-size_1-of-6','slds-large-size_1-of-5 slds-medium-size_1-of-5')} slds-size_1-of-1" rendered="{!paymethod.Type__c=='Card'}">
                                        <div class="slds-tile__detail">
                                            <div class="slds-list_vertical slds-wrap">
                                                <dt class="slds-item_label">Card Brand</dt>
                                                <dd class="slds-item_detail cardBrand">
                                                    <apex:variable var="path" value="{!logoPath}" />
                                                    <apex:outputPanel layout="block" style="white-space: normal;" styleClass=" slds-p-bottom_xx-small">
                                                        <apex:outputText value="{!paymethod.Card_Brand__c}" />
                                                    </apex:outputPanel>
                                                    <apex:outputPanel layout="block" style="white-space: normal;" styleClass="logo">
                                                        <apex:image url="{!URLFOR($Resource.Breadwinner_Payments,path)}" style="{!IF(paymethod.Card_Brand__c== 'Discover', 'width:70px;',IF(paymethod.Card_Brand__c== 'Diners Club', 'width:40px;','width:50px;'))}" />
                                                    </apex:outputPanel>
                                                </dd>
                                            </div>
                                        </div>
                                    </apex:outputPanel>
                                    
                                    <apex:outputPanel id="statusValue" styleClass="slds-col slds-tile {!IF(AND(paymethod.Type__c=='Card',NOT(ISNULL(paymethod.Card_Status__c))),'slds-large-size_1-of-6 slds-medium-size_1-of-6','slds-large-size_1-of-5 slds-medium-size_1-of-5')} slds-size_1-of-1 " rendered="{!OR(paymethod.Type__c!='Card',NOT(ISNULL(paymethod.Card_Status__c)))}">
                                        <c:PaymentAndPMDetails label="Status" fieldValue="{!paymethod.Card_Status__c}"  outputTextStyleCls="white-space: normal;text-transform: uppercase;" />
                                    </apex:outputPanel>
                                    <apex:outputPanel styleClass="slds-col slds-tile {!IF(AND(paymethod.Type__c=='Card',NOT(ISNULL(paymethod.Card_Status__c))),'slds-large-size_1-of-6 slds-medium-size_1-of-6','slds-large-size_1-of-5 slds-medium-size_1-of-5')} slds-size_1-of-1" rendered="{!OR(paymethod.Type__c=='Card',paymethod.Type__c=='BankAccount')}">
                                        <c:PaymentAndPMDetails label="Last 4 digits" fieldValue="{!paymethod.Last_4_digits__c}" />
                                    </apex:outputPanel>
                                    <apex:outputPanel styleClass="slds-col slds-tile slds-large-size_1-of-5 slds-size_1-of-1 slds-medium-size_1-of-5 total" rendered="{!AND(paymethod.Type__c=='BankAccount',paymethod.Processor_Type__c != 'Braintree')}">
                                        <c:PaymentAndPMDetails label="Country" fieldValue="{!paymethod.Country__c}" />
                                    </apex:outputPanel>
                                    <apex:outputPanel styleClass="slds-col slds-tile {!IF(AND(paymethod.Type__c=='Card',NOT(ISNULL(paymethod.Card_Status__c))),'slds-large-size_1-of-6 slds-medium-size_1-of-6','slds-large-size_1-of-5 slds-medium-size_1-of-5')} slds-size_1-of-1 " rendered="{!paymethod.Type__c=='Card'}">
                                       <c:PaymentAndPMDetails label="Expiry Date" fieldValue="{!paymethod.Expiry_Month__c} / {!paymethod.Expiry_Year__c}" />
                                    </apex:outputPanel>
                                    <apex:outputPanel styleClass="slds-col slds-tile  slds-size_1-of-1 {!IF(AND(paymethod.Type__c=='Card',NOT(ISNULL(paymethod.Card_Status__c))),'slds-large-size_1-of-6 slds-medium-size_1-of-6','slds-large-size_1-of-5 slds-medium-size_1-of-5')}" rendered="{!paymethod.Type__c=='Card'}">
                                        <div class="slds-tile__detail">
                                            <div class="slds-list_vertical slds-wrap">
                                                <dt class="slds-item_label">Address</dt>
                                                <dd class="slds-item_detail">
                                                	<c:AddressInfo strAddr1="{!paymethod.Address_Line1__c}" strAddr2="{!paymethod.Address_Line2__c}" city="{!paymethod.City__c}" state="{!paymethod.State__c}" country="{!paymethod.Address_Country__c}" postalCode="{!paymethod.Zip_Code__c}" />
                                                </dd>
                                            </div>
                                        </div>
                                    </apex:outputPanel>
                                    <apex:outputPanel styleClass="slds-col slds-tile slds-large-size_1-of-5 slds-size_1-of-1 slds-medium-size_1-of-5" rendered="{!AND(paymethod.Type__c!='Card',paymethod.Type__c!='BankAccount')}">
                                        <c:PaymentAndPMDetails label="Account Number" fieldValue="{!paymethod.Account_Number__c}" />
                                    </apex:outputPanel>
                                    <apex:outputPanel styleClass="slds-col slds-tile slds-large-size_1-of-5 slds-size_1-of-1 slds-medium-size_1-of-5" rendered="{!AND(paymethod.Type__c!='Card',paymethod.Type__c!='BankAccount')}">
                                        <c:PaymentAndPMDetails label="SWIFT Code" fieldValue="{!paymethod.SWIFT_Code__c}" />
                                    </apex:outputPanel>
                                </div>
                            </div>
                            <div class="slds-card__body slds-m-bottom_none">
                                <!-- Breadwinner info SECTION Start -->
                                <div class="slds-panel__section slds-p-top_small slds-p-bottom_none">
                                    <div class="slds-section slds-is-open">
                                        <h3 class="slds-section__title slds-theme_shade">
                                            <span class="slds-truncate slds-p-horizontal_small">
                                                <apex:outputText rendered="{!paymethod.Type__c=='Card'}" value="Card Information"/>
                                                <apex:outputText rendered="{!paymethod.Type__c=='BankAccount'}" value="Bank Account Information"/>
                                                <apex:outputText rendered="{!AND(paymethod.Type__c!='Card',paymethod.Type__c!='BankAccount')}" value="{!paymethod.Type__c} Information"/>
                                            </span>
                                        </h3>
                                        <div class="slds-section__content slds-p-around_small">
                                            <div class="slds-grid slds-gutters_large slds-has-flexi-truncate slds-wrap">
                                                <apex:outputPanel layout="block" styleClass="slds-col slds-large-size_1-of-3 slds-medium-size_1-of-2 slds-size_1-of-1">
                                                    <div class="slds-form-element slds-border_bottom defaultHeight">
                                                        <label class="slds-form-element__label">{!paymethod.Processor_Type__c} Customer</label>
                                                        <div class="slds-form-element__control">
                                                            <span class="slds-form-element__static">
                                                                <apex:outputlink value="/{!paymethod.Customer__c}" target="__blank" rendered="{!NOT(ISNULL(paymethod.Customer__c))}">
                                                                    <apex:outputText style="white-space: normal;" value="{!If((paymethod.Customer__r.Customer_Name__c != NULL), paymethod.Customer__r.Customer_Name__c, If(paymethod.Customer__r.Email__c != null, paymethod.Customer__r.Email__c, paymethod.Customer__r.Name))}"/>
                                                                </apex:outputlink>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </apex:outputPanel>
                                                <apex:outputPanel layout="block" styleClass="slds-col slds-large-size_1-of-3 slds-medium-size_1-of-2 slds-size_1-of-1">
                                                    <div class="slds-form-element slds-border_bottom defaultHeight">
                                                        <label class="slds-form-element__label">Salesforce {!customerMatchType}</label>
                                                        <div class="slds-form-element__control">
                                                            <span class="slds-form-element__static">
                                                                <apex:outputField rendered="{!customerMatchType == 'Account'}" value="{!paymethod.Account__c}"/>
                                                                <apex:outputField rendered="{!customerMatchType == 'Contact'}" value="{!paymethod.Contact__c}"/>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </apex:outputPanel>
                                                <apex:outputPanel layout="block" styleClass="slds-col slds-large-size_1-of-3 slds-medium-size_1-of-2 slds-size_1-of-1" rendered="{!AND(paymethod.Type__c=='Card', paymethod.Processor_Type__c == 'Stripe')}">
                                                    <c:AdditionalInfo label="Country" fieldValue="{!paymethod.Country__c}" />
                                                </apex:outputPanel>
                                                <apex:outputPanel layout="block" styleClass="slds-col slds-large-size_1-of-3 slds-medium-size_1-of-2 slds-size_1-of-1" rendered="{!AND(paymethod.Type__c!='Card',paymethod.Processor_Type__c != 'Braintree')}">
                                                    <c:AdditionalInfo label="Currency" fieldValue="{!paymethod.Currency__c}" outputTextStyleCls="text-transform: uppercase"/>
                                                </apex:outputPanel>
                                                <apex:outputPanel layout="block" styleClass="slds-col slds-large-size_1-of-3 slds-medium-size_1-of-2 slds-size_1-of-1" rendered="{!paymethod.Type__c!='Card'}">
                                                   <c:AdditionalInfo label="Routing Number" fieldValue="{!paymethod.Routing_Number__c}" />
                                                </apex:outputPanel>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--Breadwinner info Settings SECTION END -->
                                <!-- Additional SECTION Start -->
                                <div class="slds-panel__section slds-p-bottom_none slds-p-top_none">
                                    <div class="slds-section" id="SectionHeader">
                                        <h3 class="slds-section__title ">
                                            <button class="slds-button slds-section__title-action" type="button" onclick="showhideImage('{!$Component.switchAddInfo}');showHideSectionConent('SectionHeader','addSection');">
                                                <svg aria-hidden="true" class="slds-section__title-action-icon slds-button__icon slds-button__icon_left ">
                                                    <apex:image id="switchAddInfo" value="{!URLFOR($Resource.Breadwinner_Payments,'Breadwinner_Payments/images/Chevronright_Black.png')}" style="position: absolute;" width="14" height="15" />
                                                </svg>
                                                Additional Information
                                            </button>

                                        </h3>
                                        <div class="slds-section__content slds-p-around_small slds-p-top_none" id="addSection">
                                            <div class="slds-grid slds-gutters_large slds-has-flexi-truncate slds-wrap slds-p-top_x-small">
                                                <apex:outputPanel layout="block" styleClass="slds-col slds-large-size_1-of-3 slds-medium-size_1-of-2 slds-size_1-of-1 slds-large-order_2 slds-medium-order_2 slds-order_4">
                                                    <c:AdditionalInfo label="{!paymethod.Processor_Type__c} Id" fieldValue="{!paymethod.Processor_Id__c}" />
                                                </apex:outputPanel>
                                                <apex:outputPanel layout="block" styleClass="slds-col slds-large-size_1-of-3 slds-medium-size_1-of-2 slds-size_1-of-1 slds-large-order_3 slds-medium-order_3 slds-order_5">
                                                    <c:AdditionalInfo label="{!paymethod.Processor_Type__c} Customer Id" fieldValue="{!paymethod.Processor_Customer_Id__c}" />
                                                </apex:outputPanel>
                                                <apex:outputPanel layout="block" styleClass="slds-col slds-large-size_1-of-3 slds-medium-size_1-of-2 slds-size_1-of-1 slds-large-order_4 slds-medium-order_4 slds-order_3" rendered="{!OR(paymethod.Processor_Type__c == 'Stripe', paymethod.Processor_Type__c == 'Square')}">
                                                    <c:AdditionalInfo label="Fingerprint" fieldValue="{!paymethod.Fingerprint__c}" />
                                                </apex:outputPanel>
                                                <apex:outputPanel layout="block" styleClass="slds-col slds-large-size_1-of-3 slds-medium-size_1-of-2 slds-size_1-of-1 slds-large-order_5 slds-medium-order_5 slds-order_2">
                                                    <c:AdditionalInfo label="Livemode" fieldValue="{!IF(paymethod.Livemode__c,'Yes','No')}" />
                                                </apex:outputPanel>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Additional SECTION END -->
                            </div>
                        </div>
                        <apex:outputPanel layout="block" styleClass="slds-card__body slds-p-bottom_medium slds-card slds-m-top_none" id="relatedList">
                            <!-- Payments Section Start -->
                            <apex:outputPanel layout="block" styleClass="slds-m-top_medium slds-m-horizontal_medium">
                                <div class="slds-media slds-media_center slds-has-flexi-truncate">
                                    <div class="slds-media__figure">
                                        <span class="slds-icon_container slds-icon-custom-custom41" title="Payments">
                                            <svg class="slds-icon slds-icon_medium" aria-hidden="true">
                                                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS, 'assets/icons/custom-sprite/svg/symbols.svg#custom41')}" />
                                            </svg>
                                            <span class="slds-assistive-text">Payments</span>
                                        </span>
                                    </div>
                                    <div class="slds-media__body">
                                        <h2 class="slds-card__header-title">
                                            <span class="slds-text-heading_small">Payments</span>
                                        </h2>
                                    </div>
                                </div>
                                <apex:outputPanel id="paymentsSection">
                                    <apex:outputPanel layout="block" rendered="{!paymentsList.size==0}" styleClass="slds-m-top_medium slds-m-horizontal_medium">
                                        <div class="slds-align_absolute-center slds-border_top slds-border_bottom slds-p-top_small slds-p-bottom_small">
                                            No payments have been made using this payment method.
                                        </div>
                                    </apex:outputPanel>
                                    <apex:outputPanel rendered="{!paymentsList.size>0}">
                                        <apex:DataTable value="{!paymentsList}" var="pay" styleclass="slds-m-top_medium slds-table slds-no-row-hover slds-table_bordered slds-table_col-bordered slds-border_right slds-border_left payments slds-max-medium-table_stacked-horizontal">
                                            <apex:column headerValue="Payment #" html-data-label="Payment #" styleClass="slds-cell-wrap">
                                                <apex:outputLink value="/{!URLFOR(pay.Id)}" target="_blank" rendered="{!NOT(ISNULL(pay.Id))}">{!pay.Name}</apex:outputLink>
                                            </apex:column>
                                            <apex:column headerValue="Status" html-data-label="Status" value="{!pay.Payment_Status__c}" styleClass="slds-cell-wrap status"/>
                                            <apex:column headerValue="Description" html-data-label="Description" value="{!pay.Description__c}" styleClass="slds-cell-wrap"/>
                                            <apex:column headerValue="Amount" html-data-label="Amount" styleClass="slds-text-align_right" headerClass="slds-text-align_right" value="{!pay.Amount__c}">
                                            </apex:column>
                                        </apex:DataTable>
                                    </apex:outputPanel>
                                </apex:outputPanel>
                            </apex:outputPanel>
                            <!-- Payments Section END -->
                        </apex:outputPanel>
                    </apex:outputPanel>
                </div>
            </body>
        </html>
    </apex:form>
</apex:page>